<!doctype html>
<html ng-app='scanjs' ng-csp>
<head>
  <!-- make this useful or remove it imho
  <meta http-equiv="content-security-policy"
        content="default-src 'self'; object-src 'none'; img-src 'self' data:; script-src 'self' 'unsafe-eval">
        -->
  <link href='css/bootstrap.min.css' rel='stylesheet' media='screen'>
  <link rel="stylesheet" href="css/codemirror.css">
  <link rel="stylesheet" href="css/codemirror_theme_mdn-like.css">

  <!-- Third-party libs -->
  <script src='js/lib/jquery-2.1.0.min.js'></script>
  <script src='js/lib/angular-1.2.13.min.js'></script>
  <script src='js/lib/ui-bootstrap-tpls-0.3.0.js'></script>
  <script src="js/lib/codemirror-compressed.js"></script>
  <script src='js/lib/tern/node_modules/acorn/acorn.js'></script>
  <script src='js/lib/tern/node_modules/acorn/util/walk.js'></script>
  <script src='js/lib/tern/node_modules/acorn/acorn_loose.js'></script>
  <script src='js/lib/tern/lib/signal.js'></script>
  <script src='js/lib/tern/lib/tern.js'></script>
  <script src='js/lib/tern/lib/def.js'></script>
  <script src='js/lib/tern/lib/infer.js'></script>
  <script src='js/lib/jszip.min.js'></script>

  <!-- CommonJS modules -->
  <script src='../common/scan.js'></script>
  <script src='../common/rules.js'></script>
  <!-- Client specific files -->
  <script src='js/main.js'></script>
  <script src='js/scanctrl.js'></script>
  <script src='js/rules.js'></script>
  <script src='js/scanservice.js'></script>
  <script src='js/initTern.js'></script>

  <link rel="stylesheet" href="js/style.css" type="text/css">
</head>
<body>
<tabs id="tabwrapper">
  <pane heading='input'>
    <div ng-controller='ScanCtrl'>
      <div class="span16" id="input">
          <span class="span10">
            <div id="codeMirrorDiv"></div>
            <p>Upload file for scanning:</p>
            <input type="file" id="js-input" multiple>
            <button ng-click='run()'>Scan</button>
          </span>
          <span class="span6">
            <ul>
              <li ng-repeat="file in inputFiles track by $index">
                <a ng-click="updateCodeMirror($index)"
                   title="Examine file in preview">{{file.name}}</a>
            </ul>
          </span>
      </div>


      <div class="span16" id="results">
        <h2>Output</h2>
        <div id='output'>
          <div class="alert-error">{{error}}</div>

          <ul>
            <li ng-repeat="fileResult in results">
              <span>File:<strong>{{fileResult.filename}}</strong></span>
              <ul>
                <li ng-repeat="(rulename,ruleresult) in fileResult.findings" ng-show="ruleresult">
                <span title="{{ruleresult[0].rule.desc}}">
                  Rule:<strong>{{rulename}}</strong>({{ruleresult.length}}):
                </span>
                  <ul>
                    <li ng-repeat='result in ruleresult'>
                      <a ng-mouseover="setCursor(fileResult.filename,result.line, result.col)"
                         title="Click to highlight the affected line in the editor">Line {{result.line}}:</a><br>
                    </li>
                  </ul>
                  <span>Recommendation: {{ruleresult[0].rule.rec}}</span>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </pane>

  <pane heading='rules'>
    <div ng-controller='RuleListCtrl' class='rule-list'>
      <h2> Rules </h2>

      <div class='row'>
        <div class='span8'>
          <div class='rule-list'>
            <ol>
              <li ng-repeat='rule in rules track by $index'>
                <a ng-click='editRule($index)'>{{rule.name}}</a>
              </li>
            </ol>
          </div>
        </div>
        <div class='span6'>
          <div class='rule-detail'>

            <input type='text' id='rule_name' ng-model='current.name'>

            <br>
            <textarea type='text' id='rule_detail' ng-model='current.test'></textarea>
            <br>
            <input type='text' id='rule_desc' ng-model='current.desc'>

            <br>
            <input type='text' id='rule_rec' ng-model='current.rec'>

            <br>
            <button ng-click='saveRule()'>
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
  </pane>

</tabs>
</body>
</html>