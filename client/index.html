<!doctype html>
<html ng-app='scanjs' ng-csp>
<head>
  
  <meta http-equiv="content-security-policy" content="default-src 'self'; object-src 'none'; img-src 'self' data:; script-src 'self' 'unsafe-eval">
  <link href='css/app.css' rel='stylesheet' media='screen'>
  <link href='css/angular-csp.css' rel='stylesheet' media='screen'>

  <!-- Third-party libs -->
  <script src='js/lib/jquery-2.1.0.min.js'></script>
  <script src='js/lib/angular-1.2.13.min.js'></script>
  <script src='js/lib/ui-bootstrap-tpls-0.3.0.js'></script>
  <script src="js/lib/codemirror-compressed.js"></script>
  <script src='js/lib/jszip.min.js'></script>

  <!-- CommonJS modules -->
  <script src='../common/rules.js'></script>
  <!-- Client specific files -->
  <script src='js/main.js'></script>
  <script src='js/scanctrl.js'></script>
  <script src='js/rules.js'></script>
  <script src='js/scanservice.js'></script>
</head>
<body>
<tabs id="tabwrapper">
  <pane heading='input'>
    <div ng-controller='ScanCtrl'>
      <div class="span16" id="input">
          <span class="span10">
            <div id="codeMirrorDiv"></div>
            <p>Upload file for scanning:</p>
            <input type="file" id="js-input" multiple>
            <button ng-click='run()'>Scan</button>
          </span>
          <span class="span6">
            <ul>
              <li ng-repeat="file in inputFiles track by $index">
                <a href="#" ng-click="updateCodeMirror($index)"
                   title="Examine file in preview">{{file.name}}</a>
            </ul>
          </span>
      </div>


      <div class="span16" id="results">
        <h2>Output</h2>
        <div id='output'>
          <div class="alert-error">{{error}}</div>
          <div id="results-wrapper" ng-show="results">
              [ <a href="" ng-click="predicate=''">unsorted</a> ]
            <table id="results-table">
              <tr>
                <th><a href="" ng-click="predicate = 'rule.name'; reverse=!reverse">Rule</a></th>
                <th><a href="" ng-click="predicate = 'rule.filename'; reverse=!reverse">rule.filename</a></th>
                <th><a href="" ng-click="predicate = 'result.line'; reverse=!reverse">Line</a></th>
              </tr>
              <tr ng-repeat='result in results| orderBy:predicate:reverse'>
                <td>{{result.rule.name }}</td>
                <td>{{result.filename}}</td>
                <td><a href="#" ng-click="setCursor(result.filename,result.line, result.col)"
                       title="Click to highlight the affected line in the editor">Line {{result.line}}</a>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </pane>

  <pane heading='rules'>
    <div ng-controller='RuleListCtrl' class='rule-list'>
      <h2> Rules </h2>

      <div class='row'>
        <div class='span8'>
          <div class='rule-list'>
            <ol>
              <li ng-repeat='rule in rules track by $index'>
                <a href="#" ng-click='editRule($index)'>{{rule.name}}</a>
              </li>
            </ol>
          </div>
        </div>
        <div class='span6'>
          <div class='rule-detail'>

            <input type='text' id='rule_name' ng-model='current.name'>

            <br>
            <textarea type='text' id='rule_detail' ng-model='current.test'></textarea>
            <br>
            <input type='text' id='rule_desc' ng-model='current.desc'>

            <br>
            <input type='text' id='rule_rec' ng-model='current.rec'>

            <br>
            <button ng-click='saveRule()'>
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
  </pane>

</tabs>
</body>
</html>
